<!DOCTYPE html>
<html lang="es-MX">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de mensajes Email/WhatsApp | CobraBien v2.3</title>
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
    <meta name="description" content="Genera mensajes personalizados masivos desde Excel para cobranza.">
    <link rel="stylesheet" href="styles.css">
    <!-- SheetJS para leer Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    <script src="generador.js" defer></script>
</head>
<body>
    <header class="header-new">
        <div class="container header-content">
            <div class="logo-wrapper">
                <img src="img/logo_sinfondo.png" alt="CobraBien" class="logo">
                <div class="brand">
                    <h1>CobraBien</h1>
                    <p class="tagline">Herramientas para cobranza efectiva</p>
                </div>
            </div>
            <div class="social-links">
                <a href="https://facebook.com" target="_blank"><img src="img/facebook.png" alt="Facebook"></a>
                <a href="https://instagram.com" target="_blank"><img src="img/instagram.png" alt="Instagram"></a>
                <a href="https://wa.me/521234567890" target="_blank"><img src="img/whatsapp.png" alt="WhatsApp"></a>
            </div>
            <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar modo claro/oscuro">üåô</button>
        </div>
    </header>

    <main>
        <div class="container">
            <a href="index.html" class="back-link">‚Üê Volver a herramientas principales</a>

            <!-- Secci√≥n de bienvenida interactiva -->
            <div class="welcome-tool">
                <button id="btn-info" class="btn-info">‚ÑπÔ∏è ¬øPrimera vez? Explicaci√≥n r√°pida</button>
                <div id="info-panel" class="info-panel hidden">
                    <h3>¬øQu√© hace esta herramienta?</h3>
                    <p>Genera mensajes personalizados para cobranza (email o WhatsApp) a partir de una plantilla y un archivo Excel/CSV con los datos de tus clientes.</p>
                    <h4>C√≥mo funciona:</h4>
                    <ol>
                        <li><strong>Configurar variables:</strong> Define los nombres de las columnas de tu archivo (ej. correo, nombre, saldo).</li>
                        <li><strong>Crear plantilla:</strong> Escribe el mensaje usando <code>{{variable}}</code> (ej. "Hola {{nombre}}, tu saldo es {{saldo}}").</li>
                        <li><strong>Subir archivo:</strong> Carga tu Excel/CSV (m√°x. 1000 filas).</li>
                        <li><strong>Resultados:</strong> Navega fila por fila y copia el mensaje o el resumen.</li>
                    </ol>
                    <p><strong>Ejemplo:</strong> Si tu archivo tiene columnas "nombre", "saldo" y una plantilla "Hola {{nombre}}, debes {{saldo}}", el mensaje generado ser√° "Hola Juan, debes $1,500".</p>
                    <button id="btn-entendido" class="btn-sm btn-generar">¬°Entendido!</button>
                </div>
            </div>

            <div class="wizard">
                <!-- Indicador de pasos con bot√≥n de reinicio -->
                <div class="steps">
                    <div class="step active" data-step="1">1. Configurar variables</div>
                    <div class="step" data-step="2">2. Crear plantilla</div>
                    <div class="step" data-step="3">3. Subir archivo</div>
                    <div class="step" data-step="4">4. Resultados</div>
                    <button id="reiniciar-btn" class="btn-sm">‚Ü∫ Reiniciar</button>
                </div>

                <!-- Paso 1: Configuraci√≥n inicial -->
                <div class="step-content active" id="step1">
                    <h2>Configuraci√≥n inicial</h2>
                    <p>Define las variables que usar√°s en tus mensajes. Las columnas de tu Excel deben coincidir con estos nombres (no importan may√∫sculas, espacios o guiones bajos).</p>
                    <p>La variable <strong>correo</strong> puede ser la direcci√≥n de email o el n√∫mero de tel√©fono, seg√∫n el medio que uses (WhatsApp o email).</p>

                    <h3>Variables obligatorias</h3>
                    <div class="variables-list">
                        <div class="variable-item">
                            <span class="badge">‚ë†</span>
                            <input type="text" id="var-correo" value="correo" placeholder="columna correo o tel√©fono" required>
                        </div>
                        <div class="variable-item">
                            <span class="badge">‚ë°</span>
                            <input type="text" id="var-nombre" value="nombre" placeholder="columna nombre" required>
                        </div>
                    </div>

                    <h3>Variables adicionales</h3>
                    <div id="variables-adicionales-container"></div>
                    <button type="button" id="agregar-variable" class="btn-sm">‚ûï A√±adir variable</button>

                    <!-- Consejos anti-spam -->
                    <div class="sugerencia">
                        üì± <strong>Consejos para evitar bloqueos:</strong><br>
                        ‚Ä¢ Para <strong>WhatsApp</strong>: evita enviar muchos mensajes seguido, personaliza cada mensaje y no incluyas enlaces sospechosos. Usa la app de escritorio o WhatsApp Business para env√≠os controlados.<br>
                        ‚Ä¢ Para <strong>Email</strong>: usa un asunto personalizado y evita palabras como "urgente", "ganador", "promoci√≥n". Considera un servicio de email marketing si env√≠as m√°s de 50 correos.
                    </div>

                    <div class="button-group" style="margin-top: 2rem;">
                        <button id="step1-next" class="btn-generar">Siguiente: Crear plantilla ‚Üí</button>
                    </div>
                </div>

                <!-- Paso 2: Plantilla -->
                <div class="step-content" id="step2">
                    <h2>Redacta tu plantilla</h2>
                    <p>Usa las variables con doble llave, por ejemplo: <code>{{nombre}}</code>, <code>{{saldo}}</code>.</p>

                    <div class="input-group">
                        <label>Mensaje principal:</label>
                        <textarea id="plantilla-mensaje" rows="8" placeholder="Escribe aqu√≠ la plantilla del mensaje..."></textarea>
                    </div>

                    <!-- Opci√≥n de resumen -->
                    <div class="opcion-resumen">
                        <label>
                            <input type="checkbox" id="habilitar-resumen">
                            <span>¬øDefinir plantilla de resumen adicional?</span>
                        </label>
                        <div id="resumen-container" style="display: none;">
                            <div class="input-group">
                                <label>Plantilla de resumen:</label>
                                <textarea id="plantilla-resumen" rows="4" placeholder="Escribe aqu√≠ la plantilla de resumen..."></textarea>
                                <small>Este texto se mostrar√° en el paso de resultados y podr√°s copiarlo f√°cilmente.</small>
                            </div>
                        </div>
                    </div>

                    <div class="sugerencia">
                        üí° <strong>Sugerencia:</strong> Si vas a enviar por email, recuerda personalizar el asunto para evitar spam. Esta herramienta solo genera el cuerpo del mensaje.
                    </div>

                    <div id="checklist-variables">
                        <h3>Variables disponibles:</h3>
                        <div id="variables-disponibles" class="variables-list"></div>
                    </div>

                    <div class="button-group">
                        <button id="step2-prev" class="btn-limpiar">‚Üê Anterior</button>
                        <button id="step2-next" class="btn-generar">Siguiente: Subir archivo ‚Üí</button>
                    </div>
                </div>

                <!-- Paso 3: Subir archivo -->
                <div class="step-content" id="step3">
                    <h2>Sube tu archivo Excel o CSV</h2>
                    <p>Selecciona un archivo con las columnas que definiste. M√°ximo 1000 filas (sin contar encabezados).</p>

                    <div class="file-upload" id="file-upload-area">
                        <input type="file" id="file-input" accept=".xlsx,.xls,.csv">
                        <p>Arrastra tu archivo aqu√≠ o haz clic para seleccionar</p>
                        <p style="font-size: 0.9rem; opacity: 0.7;">Formatos soportados: .xlsx, .xls, .csv</p>
                    </div>
                    <p style="font-size: 0.85rem; margin-top: 0.5rem; color: var(--primary-green);">
                        üîí Tus archivos nunca se suben a ning√∫n servidor. Todo el procesamiento ocurre en tu navegador.
                    </p>
                    <div id="preview-container" style="display: none;">
                        <h3>Vista previa (primeras 5 filas)</h3>
                        <div class="preview-table" id="preview-table"></div>
                        <p id="row-count"></p>
                    </div>

                    <div class="button-group">
                        <button id="step3-prev" class="btn-limpiar">‚Üê Anterior</button>
                        <button id="step3-next" class="btn-generar" disabled>Siguiente: Generar mensajes ‚Üí</button>
                    </div>
                </div>

                <!-- Paso 4: Resultados (con navegaci√≥n r√°pida) -->
                <div class="step-content" id="step4">
                    <h2>Mensajes generados</h2>
                    <p>Aqu√≠ tienes los mensajes personalizados. Navega entre las filas y copia lo que necesites.</p>
                    <p><small>‚ÑπÔ∏è El campo "correo" corresponde a la columna que definiste; puede ser email o tel√©fono seg√∫n tu necesidad.</small></p>

                    <div id="navegacion-resultados">
                        <button id="resultado-anterior" class="btn-sm" disabled>‚Üê Anterior</button>
                        <span id="contador-fila">Fila 1 de 0</span>
                        <button id="resultado-siguiente" class="btn-sm" disabled>Siguiente ‚Üí</button>
                    </div>

                    <!-- Navegaci√≥n r√°pida -->
                    <div style="display: flex; gap: 0.5rem; align-items: center; margin-bottom: 1rem;">
                        <label for="ir-fila" style="font-weight: 600;">Ir a fila:</label>
                        <input type="number" id="ir-fila" min="1" style="width: 80px; padding: 0.3rem; border-radius: 0.5rem; border: 1px solid var(--border-color);">
                        <button id="btn-ir-fila" class="btn-sm">Ir</button>
                    </div>

                    <div id="resultado-actual" class="result-item"></div>

                    <div class="button-group" style="margin-top: 2rem;">
                        <button id="step4-prev" class="btn-limpiar">‚Üê Anterior</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast -->
    <div id="toast" class="toast hidden">‚úÖ Mensaje copiado</div>

    <footer class="footer-new">
        <div class="container footer-content">
            <div class="footer-social">
                <a href="https://facebook.com" target="_blank"><img src="img/facebook.png" alt="Facebook"></a>
                <a href="https://instagram.com" target="_blank"><img src="img/instagram.png" alt="Instagram"></a>
                <a href="https://wa.me/521234567890" target="_blank"><img src="img/whatsapp.png" alt="WhatsApp"></a>
            </div>
            <button id="sugerencia-btn" class="btn-sugerencia">üì≤ Enviar sugerencia</button>
            <p class="footer-credito">
                ¬øTe gust√≥ la herramienta o tienes alguna sugerencia?
                ¬°Queremos mejorar! Escr√≠benos por WhatsApp. <br>
                Creado por Ismael Palencia, 2026 |
                <a href="versiones.html">Novedades</a> |
                <a href="privacidad.html">Privacidad</a>
            </p>
        </div>
</footer>
    <div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: var(--card-bg); color: var(--text-color); padding: 1rem; text-align: center; border-top: 1px solid var(--border-color); z-index: 10000; box-shadow: var(--shadow); display: none;">
        üç™ Usamos cookies de Google Analytics para mejorar tu experiencia. Al hacer clic en "Aceptar", consientes su uso.
        <button id="accept-cookies" class="btn-sm" style="background: var(--primary-green); color: white; border: none; margin: 0 0.5rem;">Aceptar</button>
        <a href="privacidad.html" style="color: var(--primary-green);">M√°s informaci√≥n</a>
    </div>
    <script>
        function cargarGoogleAnalytics() {
            const script1 = document.createElement('script');
            script1.async = true;
            script1.src = 'https://www.googletagmanager.com/gtag/js?id=G-80WCM4B3E6';
            document.head.appendChild(script1);

            const script2 = document.createElement('script');
            script2.innerHTML = `
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-80WCM4B3E6');
            `;
            document.head.appendChild(script2);
        }

        if (localStorage.getItem('cookiesAccepted')) {
            document.getElementById('cookie-banner').style.display = 'none';
            cargarGoogleAnalytics();
        } else {
            document.getElementById('cookie-banner').style.display = 'block';
        }

        document.getElementById('accept-cookies').addEventListener('click', function() {
            localStorage.setItem('cookiesAccepted', 'true');
            document.getElementById('cookie-banner').style.display = 'none';
            cargarGoogleAnalytics();
        });
    </script>
</body>
</html>
